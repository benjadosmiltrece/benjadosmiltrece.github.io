<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >
  <title>Random YouTube Video Grid</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f4f4;
    }
    #video-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(3, auto);
      gap: 10px;
    }
    .video-button {
      display: block;
      padding: 10px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      text-decoration: none;
      color: #333;
      font-size: 12px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .video-button:hover {
      background: #eaeaea;
    }
  </style>
</head>
<body>
  <h1>Truly Random YouTube Video Grid</h1>
  <div id="video-grid"></div>

  <script>
    const API_KEY = 'AIzaSyCswR47qg8FhcppTo-K48CHguWg1VUIylk';
    const TOTAL_VIDEOS = 30; // 3 rows x 10 cols
    const MAX_RESULTS = 50;
    const ALPHANUM = 'abcdefghijklmnopqrstuvwxyz0123456789';

    // Generate a random search term (single character or two)
    function randomQuery() {
      const len = Math.random() < 0.3 ? 2 : 1; // sometimes two chars
      let s = '';
      for (let i = 0; i < len; i++) {
        s += ALPHANUM.charAt(Math.floor(Math.random() * ALPHANUM.length));
      }
      return s;
    }

    // Fetch videos by random search
    async function fetchRandomBatch() {
      const q = randomQuery();
      const url = new URL('https://www.googleapis.com/youtube/v3/search');
      url.search = new URLSearchParams({
        part: 'snippet',
        q,
        type: 'video',
        maxResults: MAX_RESULTS,
        key: API_KEY
      });
      const res = await fetch(url);
      if (!res.ok) throw new Error(res.statusText);
      const data = await res.json();
      return data.items;
    }

    // Get one random video, retry on duplicates
    async function getRandomVideo(seenIds) {
      let attempts = 0;
      while (attempts < 5) {
        const batch = await fetchRandomBatch();
        const choice = batch[Math.floor(Math.random() * batch.length)];
        if (!seenIds.has(choice.id.videoId)) {
          return choice;
        }
        attempts++;
      }
      throw new Error('Too many duplicates');
    }

    // Main init
    async function init() {
      const seen = new Set();
      const videos = [];
      try {
        for (let i = 0; i < TOTAL_VIDEOS; i++) {
          const vid = await getRandomVideo(seen);
          seen.add(vid.id.videoId);
          videos.push(vid);
        }
        renderGrid(videos);
      } catch (e) {
        console.error(e);
        document.getElementById('video-grid').textContent = 'Error loading random videos.';
      }
    }

    function renderGrid(items) {
      const grid = document.getElementById('video-grid');
      items.forEach(v => {
        const a = document.createElement('a');
        a.href = `https://youtu.be/${v.id.videoId}`;
        a.target = '_blank';
        a.className = 'video-button';
        a.textContent = v.snippet.title;
        grid.appendChild(a);
      });
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
